version: "3.8"
services:
  api:
    build:
      context: api/
    # TODO: how to add .git to build context?
    container_name: mlops-fastapi-api
    restart: always
    volumes:
      - ./api/:/app
      - .git/:/app/.git/
    ports:
      - 8000:8000
    command: ['uvicorn',
              'main:app',
              '--reload',
              '--reload-include',
              '*.pickle',
              "--host",
              "0.0.0.0"]  
  prometheus:
    image: prom/prometheus
    container_name: mlops-fastapi-prometheus
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
    ports: 
      - 9090:9090